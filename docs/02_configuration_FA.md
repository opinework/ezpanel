# راهنمای پیکربندی

**زبان**: [English](./02_configuration.md) | [简体中文](./02_configuration_CN.md) | [繁體中文](./02_configuration_TW.md) | [Русский](./02_configuration_RU.md) | فارسی

فایل اصلی پیکربندی EzPanel در مسیر `/etc/ezpanel/config.yaml` قرار دارد.

---

## مرجع کامل پیکربندی

```yaml
# ================================
# EzPanel 配置文件
# ================================

# پیکربندی سرور
server:
  host: "0.0.0.0"        # آدرس شنود؛ 0.0.0.0 یعنی تمام رابط‌های شبکه
  port: 7088              # پورت شنود، پیش‌فرض 7088
  mode: "release"         # حالت اجرا: debug / release / test

# پیکربندی پایگاه داده (اجباری)
database:
  host: "127.0.0.1"
  port: 3306
  user: "ezpanel"
  password: "your_password"
  dbname: "ezpanel"
  charset: "utf8mb4"
  max_idle_conns: 10      # حداکثر تعداد اتصالات بیکار
  max_open_conns: 100     # حداکثر تعداد اتصالات باز

# پیکربندی Redis (اختیاری)
redis:
  host: "127.0.0.1"
  port: 6379
  password: ""
  db: 0

# پیکربندی JWT
jwt:
  secret: "change-this-to-a-random-string"  # حتماً تغییر دهید!
  expire: 168             # مدت اعتبار توکن (ساعت)، 168 = 7 روز
  issuer: "ezpanel"

# پیکربندی لاگ
log:
  level: "warn"           # سطح لاگ: debug / info / warn / error
  format: "console"       # فرمت خروجی: json / console
  output: "stdout"        # مکان خروجی: stdout / file / both
  file_path: "/var/log/ezpanel/app.log"

# مستندات Swagger API
swagger:
  enable: false           # در محیط تولید غیرفعال کنید

# مانیتورینگ گره (XrayM)
node:
  report_metrics: true    # فعال‌سازی ارسال داده‌های مانیتورینگ گره

# پیکربندی آپلود
upload:
  path: "/var/lib/ezpanel/upload"
  max_size: 10            # حداکثر اندازه هر فایل (مگابایت)
  allowed_types:
    - image/jpeg
    - image/png
    - image/gif
    - image/webp

# پیکربندی CORS
cors:
  allow_origins:
    - "*"                 # در محیط تولید با دامنه واقعی جایگزین کنید، مثلاً https://panel.example.com
  allow_credentials: true
  max_age: 12

# ماژول تجاری (نسخه Pro / Enterprise)
# commercial:
#   pro_binary_path: "/usr/bin/ezpanel-pro"
#   license_path: "/etc/ezpanel/license.json"
#   socket_path: "/run/ezpanel/commercial.sock"
```

---

## توضیح گزینه‌های پیکربندی

### server

| گزینه | مقدار پیش‌فرض | توضیح |
|-------|--------------|-------|
| `host` | `0.0.0.0` | آدرس شنود. برای دسترسی محلی (پشت Nginx)، به `127.0.0.1` تغییر دهید |
| `port` | `7088` | پورت شنود |
| `mode` | `release` | حالت `debug` لاگ تفصیلی خروجی می‌دهد؛ در محیط تولید از `release` استفاده کنید |

### database

| گزینه | توضیح |
|-------|-------|
| `host` | آدرس هاست MySQL |
| `port` | پورت MySQL، پیش‌فرض 3306 |
| `user` | نام کاربری پایگاه داده |
| `password` | رمز عبور پایگاه داده |
| `dbname` | نام پایگاه داده (باید از قبل دستی ایجاد شود) |
| `max_open_conns` | حداکثر تعداد اتصالات؛ بر اساس پیکربندی سرور تنظیم کنید، توصیه‌شده: 50 تا 200 |

### redis

Redis یک مؤلفه اختیاری است. در صورت عدم پیکربندی، سیستم همچنان کار می‌کند اما قابلیت‌های زیر غیرفعال می‌شوند:

- شتاب‌دهی با کش توزیع‌شده
- محدودیت جهانی دستگاه بین گره‌های XrayM

### jwt

| گزینه | توضیح |
|-------|-------|
| `secret` | کلید امضای JWT. **باید با یک رشته تصادفی جایگزین شود** — افشای آن خطر امنیتی ایجاد می‌کند |
| `expire` | مدت اعتبار توکن (ساعت)؛ تغییر آن روی توکن‌های موجود تا انقضا تأثیر ندارد |

تولید کلید تصادفی:
```bash
openssl rand -hex 32
```

### log

| سطح | توضیح | سناریو استفاده |
|-----|-------|---------------|
| `debug` | همه لاگ‌ها را شامل دستورات SQL خروجی می‌دهد | توسعه و اشکال‌زدایی محلی |
| `info` | اطلاعات عمومی خروجی می‌دهد | محیط آزمایش |
| `warn` | فقط هشدارها و خطاها را خروجی می‌دهد | **توصیه‌شده برای محیط تولید** |
| `error` | فقط خطاها را خروجی می‌دهد | محیط تولید پایدار |

---

## تنظیمات سیستم در پنل مدیریت

موارد زیر به **پنل مدیریت ← تنظیمات سیستم** منتقل شده‌اند و نیازی به وارد کردن در فایل پیکربندی ندارند:

### اطلاعات سایت

- نام و لوگوی سایت
- URL سایت، URL اشتراک
- تنظیمات ثبت‌نام (ثبت‌نام باز، کد دعوت)

### ایمیل (SMTP)

- آدرس و پورت سرور SMTP
- نام کاربری و رمز عبور
- آدرس فرستنده
- مدیریت قالب‌های ایمیل

### ربات Telegram (اختیاری)

1. در [@BotFather](https://t.me/BotFather) یک ربات بسازید و توکن دریافت کنید
2. توکن ربات را در پنل مدیریت وارد کنید
3. روی «تنظیم Webhook» کلیک کنید تا پیکربندی کامل شود

کاربران می‌توانند با دستورات زیر حساب خود را متصل کنند:
- `/bindaccount` — شروع اتصال
- `/bindcode <کد>` — تکمیل اتصال
- `/bindstatus` — مشاهده وضعیت اتصال

### درگاه پرداخت (نسخه Pro)

تنظیمات پرداخت در پنل مدیریت ← تنظیمات پرداخت مدیریت می‌شوند. پشتیبانی می‌شود:

| نوع | توضیح |
|-----|-------|
| EPay | پلتفرم پرداخت تجمیعی، پشتیبانی از Alipay، WeChat و غیره. توصیه‌شده |
| Alipay (QR حضوری) | پرداخت با اسکن کد |
| Alipay (وب) | انتقال به صفحه پرداخت |
| WeChat Pay | پرداخت با کد QR |
| Stripe | کارت اعتباری بین‌المللی |

### کلید API گره

کلید API استفاده‌شده برای ارتباط بین گره‌ها و پنل. مشاهده و تغییر: پنل مدیریت ← تنظیمات سیستم ← کلید API گره.

---

## استقرار چندنمونه‌ای

برای اجرای چندین نمونه پنل روی یک سرور، کافی است پورت و دایرکتوری پیکربندی هر نمونه را تغییر دهید:

```yaml
# پیکربندی نمونه ۲
server:
  port: 7089

database:
  dbname: "ezpanel2"
```

سپس فایل سرویس systemd مربوطه را ایجاد کنید.
